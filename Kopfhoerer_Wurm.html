<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Ohrwurm Snake ðŸŽ§</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      background: #181b2a;
      color: #e8ecff;
      font-family: system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
    }
    h1 { margin-top: 24px; }
    #hud {
      margin: 12px 0 8px;
      display: flex;
      gap: 16px;
      font-size: 16px;
      background: #22243a;
      border-radius: 10px;
      padding: 8px 18px;
      box-shadow: 0 2px 12px #0007;
      align-items: center;
    }
    #gameCanvas {
      background: #101223;
      border-radius: 18px;
      box-shadow: 0 8px 48px #000a, 0 0 0 2px #23254a;
      margin-bottom: 18px;
      display: block;
      touch-action: none;
    }
    #overlay {
      position: absolute;
      left: 0; right: 0; top: 0; bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(24,27,42,0.89);
      color: #e8ecff;
      font-size: 20px;
      z-index: 10;
      border-radius: 18px;
      flex-direction: column;
    }
    #overlay.hidden { display: none; }
    #overlay button {
      background: linear-gradient(180deg,#a6df59 0,#78c23a 100%);
      color: #0b1600;
      border: none;
      padding: 10px 18px;
      border-radius: 10px;
      font-weight: 700;
      font-size: 18px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 6px 16px #a6df5933;
    }
    #footer {
      color: #9aa3c7;
      font-size: 13px;
      margin-bottom: 18px;
      text-align: center;
    }
    /* Touch D-Pad */
    #dpad {
      position: absolute;
      right: 10px;
      bottom: 10px;
      display: grid;
      grid-template-areas:
        ". up ."
        "left . right"
        ". down .";
      gap: 6px;
      opacity: .85;
      user-select: none;
    }
    #dpad button {
      width: 48px; height: 48px;
      border-radius: 10px;
      border: 1px solid #fff3;
      background: #fff1;
      color: #e8ecff;
      font-weight: 800;
      font-size: 24px;
      cursor: pointer;
      touch-action: manipulation;
    }
    #dpad .up { grid-area: up; }
    #dpad .down { grid-area: down; }
    #dpad .left { grid-area: left; }
    #dpad .right { grid-area: right; }
    @media (min-width: 700px) { #dpad { display: none; } }
    .canvasWrap { position: relative; }
  </style>
</head>
<body>
  <h1>Ohrwurm Snake ðŸŽ§</h1>
  <div id="hud">
    <span>Punkte: <b id="score">0</b></span>
    <span>Tempo: <b id="speed">1</b>x</span>
    <span>Best: <b id="best">0</b></span>
    <span style="font-size:13px;color:#a6df59;">Steuerung: Pfeiltasten / WASD / Touch</span>
  </div>
  <div class="canvasWrap" style="width:520px;max-width:96vw;">
    <canvas id="gameCanvas" width="520" height="520"></canvas>
    <div id="overlay">
      <div>Steuere den Ohrwurm, futtere KopfhÃ¶rer und wachse.<br>Vermeide Kollisionen!</div>
      <button id="startBtn">Los gehtâ€™s</button>
    </div>
    <div id="dpad" aria-hidden="true">
      <button class="up" data-dir="up">â–²</button>
      <button class="left" data-dir="left">â—€</button>
      <button class="right" data-dir="right">â–¶</button>
      <button class="down" data-dir="down">â–¼</button>
    </div>
  </div>
  <div id="footer">
    Je mehr du isst, desto schneller wird der Wurm.<br>Leertaste: Pause
  </div>
  <script>
    // Spiel-Konstanten
    const GRID = 20, TILE = 26, CANVAS_SIZE = GRID * TILE;
    const START_LENGTH = 5, START_SPEED_MS = 160, MIN_SPEED_MS = 70, SPEED_STEP = 8;
    const HEAD_COLOR = "#9bdb4d", BODY_COLOR = "#7ec23a", FOOD_COLOR = "#e8ecff";
    const canvas = document.getElementById("gameCanvas"), ctx = canvas.getContext("2d");
    const overlay = document.getElementById("overlay"), startBtn = document.getElementById("startBtn");
    const elScore = document.getElementById("score"), elBest = document.getElementById("best"), elSpeed = document.getElementById("speed");
    let snake, dir, nextDir, food, score, tickMs, timer, running, bestScore = 0, paused = false;

    function resetGame() {
      dir = "right"; nextDir = "right";
      score = 0; tickMs = START_SPEED_MS;
      snake = [];
      for (let i = START_LENGTH; i > 0; i--)
        snake.push({ x: i, y: Math.floor(GRID / 2) });
      food = spawnFood();
      updateHUD();
      paused = false;
    }
    function updateHUD() {
      elScore.textContent = score;
      elSpeed.textContent = (START_SPEED_MS / tickMs).toFixed(1);
      elBest.textContent = bestScore;
    }
    function spawnFood() {
      let pos;
      do {
        pos = { x: Math.floor(Math.random() * GRID), y: Math.floor(Math.random() * GRID) };
      } while (snake.some(s => s.x === pos.x && s.y === pos.y));
      return pos;
    }
    function draw() {
      ctx.clearRect(0,0,CANVAS_SIZE,CANVAS_SIZE);
      // Grid
      ctx.save();
      ctx.strokeStyle = "#fff1";
      for(let i=1;i<GRID;i++) {
        ctx.beginPath();
        ctx.moveTo(i*TILE,0); ctx.lineTo(i*TILE,CANVAS_SIZE);
        ctx.moveTo(0,i*TILE); ctx.lineTo(CANVAS_SIZE,i*TILE);
        ctx.stroke();
      }
      ctx.restore();
      // Food: KopfhÃ¶rer
      drawHeadphone(food.x*TILE, food.y*TILE, TILE, TILE);
      // Snake
      snake.forEach((s,i) => {
        if (i === 0) drawWormHead(s.x*TILE, s.y*TILE, TILE, TILE, dir);
        else drawWormBody(s.x*TILE, s.y*TILE, TILE, TILE);
      });
    }
    function drawWormHead(x, y, w, h, dir) {
      ctx.save();
      ctx.translate(x+w/2, y+h/2);
      // Kopfkreis
      ctx.beginPath();
      ctx.arc(0,0,w/2.1,0,2*Math.PI);
      ctx.fillStyle = HEAD_COLOR;
      ctx.shadowColor = "#bfff7f";
      ctx.shadowBlur = 8;
      ctx.fill();
      // Musiknote
      ctx.rotate({up:0,left:-Math.PI/2,down:Math.PI,right:Math.PI/2}[dir]);
      ctx.beginPath();
      ctx.moveTo(3,-6); ctx.lineTo(3,-16);
      ctx.moveTo(-3,-6); ctx.lineTo(-3,-16);
      ctx.moveTo(3,-16); ctx.arc(3,-18,2,0,2*Math.PI);
      ctx.moveTo(-3,-16); ctx.arc(-3,-18,2,0,2*Math.PI);
      ctx.strokeStyle="#222";
      ctx.lineWidth=2;
      ctx.stroke();
      ctx.restore();
    }
    function drawWormBody(x, y, w, h) {
      ctx.save();
      ctx.translate(x+w/2, y+h/2);
      ctx.beginPath();
      ctx.arc(0,0,w/2.3,0,2*Math.PI);
      ctx.fillStyle = BODY_COLOR;
      ctx.shadowColor = "#bfff7f";
      ctx.shadowBlur = 5;
      ctx.fill();
      ctx.restore();
    }
    function drawHeadphone(x,y,w,h) {
      ctx.save();
      ctx.translate(x+w/2, y+h/2);
      // KopfhÃ¶rer-BÃ¼gel
      ctx.beginPath();
      ctx.arc(0,0,w/2.5,Math.PI*0.75,Math.PI*2.25);
      ctx.strokeStyle = "#a6dfef";
      ctx.lineWidth = 5;
      ctx.stroke();
      // Ohrpolster
      ctx.beginPath();
      ctx.arc(-w/3.5,w/5.2,4,0,2*Math.PI);
      ctx.arc(w/3.5,w/5.2,4,0,2*Math.PI);
      ctx.fillStyle = "#e8ecff";
      ctx.fill();
      ctx.restore();
    }
    function moveSnake() {
      let dx=0,dy=0;
      if (dir==="up") dy=-1;
      else if (dir==="down") dy=1;
      else if (dir==="left") dx=-1;
      else if (dir==="right") dx=1;
      let newHead = { x: snake[0].x+dx, y: snake[0].y+dy };
      // Kollision Wand
      if (newHead.x<0||newHead.x>=GRID||newHead.y<0||newHead.y>=GRID) return false;
      // Kollision Selbst
      if (snake.some(s=>s.x===newHead.x&&s.y===newHead.y)) return false;
      snake.unshift(newHead);
      if (newHead.x===food.x&&newHead.y===food.y) {
        score++;
        if (tickMs>SPEED_STEP+MIN_SPEED_MS) tickMs-=SPEED_STEP;
        food=spawnFood();
      } else {
        snake.pop();
      }
      updateHUD();
      return true;
    }
    function gameLoop() {
      if (!running || paused) return;
      dir = nextDir;
      if (!moveSnake()) return gameOver();
      draw();
      timer = setTimeout(gameLoop, tickMs);
    }
    function gameOver() {
      running = false;
      clearTimeout(timer);
      if (score>bestScore) { bestScore=score; localStorage.setItem("ohrwurm_best",score); }
      updateHUD();
      overlay.innerHTML = `<div>Game Over!<br>Punkte: <b>${score}</b></div><button id="startBtn">Nochmal!</button>`;
      overlay.classList.remove("hidden");
      document.getElementById("startBtn").onclick = startGame;
    }
    function startGame() {
      resetGame();
      draw();
      overlay.classList.add("hidden");
      running=true;
      timer=setTimeout(gameLoop,tickMs);
    }
    // Steuerung
    function setDirection(d) {
      // Keine RÃ¼ckwÃ¤rtsrichtung
      if (d==="up"    && dir!=="down")  nextDir="up";
      if (d==="down"  && dir!=="up")    nextDir="down";
      if (d==="left"  && dir!=="right") nextDir="left";
      if (d==="right" && dir!=="left")  nextDir="right";
    }
    document.addEventListener("keydown",e=>{
      if (!running && e.code!=="Space") return;
      if (["ArrowUp","KeyW"].includes(e.code))   setDirection("up");
      if (["ArrowDown","KeyS"].includes(e.code)) setDirection("down");
      if (["ArrowLeft","KeyA"].includes(e.code)) setDirection("left");
      if (["ArrowRight","KeyD"].includes(e.code))setDirection("right");
      if (e.code==="Space") {
        paused=!paused;
        if (running && !paused) gameLoop();
      }
    });
    // Touch DPad
    document.querySelectorAll("#dpad button").forEach(btn=>{
      btn.addEventListener("touchstart",e=>{
        setDirection(btn.dataset.dir);
        e.preventDefault();
      });
    });
    // Touch Swipe
    let touchStartX=0,touchStartY=0;
    canvas.addEventListener("touchstart",e=>{
      let t=e.touches[0];
      touchStartX=t.clientX; touchStartY=t.clientY;
    });
    canvas.addEventListener("touchend",e=>{
      let t=e.changedTouches[0];
      let dx=t.clientX-touchStartX, dy=t.clientY-touchStartY;
      if (Math.abs(dx)>Math.abs(dy)) {
        if (dx>20) setDirection("right");
        else if (dx<-20) setDirection("left");
      } else {
        if (dy>20) setDirection("down");
        else if (dy<-20) setDirection("up");
      }
    });
    // LocalStorage Highscore
    try {
      let best = localStorage.getItem("ohrwurm_best");
      if (best) bestScore = parseInt(best);
    } catch(e){}
    // Overlay Start
    startBtn.onclick = startGame;
    // Initial
    resetGame();
    draw();
  </script>
</body>
</html>
